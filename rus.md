# Сногсшибательная отзывчивая разметка с CSS-областями

Возможности веб-разработчиков существенно стеснены инструментарием верстки, который им доступен. Контент, помещённый в контейнер обычно растягивает его границы по вертикали. Если согласно проекту элементы должны сохранять определённую высоту, наш выбор ограничен. В таком случае можно либо добавить полосу прокрутки, либо спрятать контент, который не помещается в контейнер. Спецификация CSS-областей (CSS Regions) предлагает новый вариант.

## Поддержка

Области — это новая часть спецификации CSS, потому они реализованы не во всех браузерах, и в некоторых нужно разрешить их отображение в настройках. Для них недавно была добавлена поддержка в iOS7 и Safari 7, а также Safari 6.1+. Команда Adobe составила [список поддерживающих браузеров и инструкции][1] по активации областей и других инструментов. Тем не менее, поддержка областей постоянно растёт. Полный список браузеров, которые поддерживают области и различные доступные возможности можно увидеть на [странице «Поддержка CSS-областей» авторства Adobe][2].

## Введение в области

CSS-области дают нам возможность распределять контент между несколькими элементами-контейнерами. Они предусматривают **поток**, состоящий из контента, который может быть помещён в несколько элементов и **цепочку областей**, которая является совокупностью элементов, между которыми распределяется поток. Поток динамически заполняет элементы в цепочке областей, когда эти элементы прописаны в разметке. Затем можно изменять размер контейнеров по вертикали не беспокоясь, что часть контента будет обрезана, так как он просто перераспределится в следующий элемент цепочки. Это создаёт новые перспективы для верстки отзывчивого дизайна.

Чтобы использовать области начните с создания потока с заданным названием; просто добавьте свойство `flow-into` для элемента с контентом и присвойте ему название вашего потока в качестве значения. Затем для каждой области, которую вы хотите использовать в качестве контейнера для потока, укажите свойство `flow-from` с тем же значением-названием потока. Содержимое первого элемента будет перетекать в остальные элементы-области. На данный момент браузеры нуждаются в указании префикса для свойства, но здесь мы используем версию без префикса.

    #myContent {
        flow-into: myNamedFlow;
    }

    .myRegion {
        flow-from: myNamedFlow;
    }

Наша HTML-разметка будет содержать элемент с контентом и каскад областей, в которые этот контент должен распределяться. Когда мы используем области, элемент с контентом не отображается в своей исходной позиции и любой HTML-код, помещённый в элементы-области исчезнет, его место занимает контент из потока. Поэтому мы можем поместить плейсхолдер или резервный контент в элементы-области.

    <div class="myRegion"></div>
    <div class="myRegion"></div>
    <div class="myRegion"></div>

    <div id="myContent">…</div>

При использовании областей, распределяемый контент не является дочерним по отношению к элементам-областям. Мы всего лишь меняем место отображения контента. Согласно DOM всё остаётся в исходном состоянии, следовательно контент не наследует стили от области, в которую он помещён. Вместо этого в спецификации определён псевдо-селектор `::region()`, который позволяет стилизировать контент в пределах области. Нужно прописать псевдоселектор для селектора области и затем передать селектор в качестве аргумента, обозначая для каких элементов будет применяться стиль в пределах конкретной области.

    .myRegion::region(p){
        /*стили для абзацев(p), которые распределяются между областями*/
    }

## Использование областей в отзывчивом дизайне

Отзывчивый дизайн — это техника создания пластичной верстки, которая растягивается и изменяется в зависимости от контекста. Разработчики часто используют процентные значения и медиазапросы чтобы сделать элементы гибкими и адаптировать верстку для экранов разных размеров. Отзывчивый дизайн приспосабливает контент для любого экрана без необходимости для разработчика перестраивать дизайн или код. 

Области упрощают создание отзывчивого дизайна. Во-первых, нам больше не нужно полагаться на `height: auto` для каждого элемента чтобы убедиться что контент поместится. Вместо этого мы можем разрешить контенту распределяться между несколькими элементами верстки. Это значит, что контент не диктует какой должна быть верстка, а скорее подстраивается под задуманный дизайн. Всё же можно использовать `height: auto` для последней области чтобы убедиться что она расширится чтобы вместить весь оставшийся контент. Использование этого приёма можно увидеть в примере с CodePen, размещённом ниже.

<iframe id="cp_embed_zJpba" src="//codepen.io/cjgammon/embed/zJpba?default-tab=result&amp;user=cjgammon&amp;slug-hash=zJpba&amp;theme-id=0&amp;height=268" allowtransparency="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;" frameborder="0" height="268" scrolling="no"></iframe>

## Области и события

Для областей можно использовать JavaScript-события чтобы управлять версткой и обеспечить корректное отображение контента. В спецификации областей описаны события, которые можно использовать при определённых состояниях. Событие `regionoversetchange` запускается когда для какой-либо области меняется свойство `regionOverset`. Это может случиться когда пользователь изменяет размеры страницы, растягивая элемент-контейнер таким образом, что контент больше не заполняет некоторые области. `regionOverset` может принимать значения `fit`, `overset` или `empty`. Значение `empty` указывает на то, что внутри области нет контента. Свойство `regionOverset` принимает значение `overset` когда последняя область в цепочке не может вместить весь оставшийся контент, при чём часть контента становится невозможно прочитать. 

Значение `fit` указывает на то, что контент должным образом заполнил область, полностью (если это одна из областей в середине цепочке) или частично (если это последняя область в цепочке). Реакция на эти события зависит от дизайна, контента и других аспектов верстки. Эти события можно использовать чтобы динамически добавлять и удалять области, или чтобы применить класс, изменяющий расположение элементов. Ниже можно увидеть пример с CodePen.

**Примечание:** В некоторых реализациях вместо события `regionoversetchange` вызывается `regionlayoutupdate` согласно предыдущей версии спецификации.

<iframe id="cp_embed_okmGu" src="//codepen.io/cjgammon/embed/okmGu?default-tab=result&amp;user=cjgammon&amp;slug-hash=okmGu&amp;theme-id=0&amp;height=268" allowtransparency="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;" frameborder="0" height="268" scrolling="no"></iframe>

## Области и медиазапросы

Области определяются исключительно в CSS, что делает их использование в комбинации с медиазапросами простым. Кроме изменения размеров и позиционирования элементов, можно также изменять то, какие элементы используются как области. Также можно присвоить для области `display: none`, вследствие чего она будет полностью исключена из цепочки областей. Благодаря такой способности отдельные области можно легко удалить из страницы не беспокоясь о целостности контента. Этот приём можно также использовать для отображения абсолютно разных макетов без изменения контента.

## Области и свойства разрывов

CSS-области позаимствовали свойства разрывов из спецификации по многоколоночной верстке (multi-column layout specification), которые можно использовать для определения разбивки контента по областям. Эти свойства можно применить для элементов в потоке чтобы указать, что внутри них должен быть разрыв или же чтобы этого избежать. Использование значения `region` для `break-before` или `break-after` приведёт к принудительному разрыву перед или после соответствующего элемента. Значение `avoid-region` может быть использовано для `break-before`, `break-after` и `break-inside` чтобы избежать разрывов перед, после или внутри элемента.

Этот приём полезен когда нужно сгруппировать взаимосвязанные элементы и предотвратить разделение важных элементов. В демо ниже представлен поток изображений в правой колонке и поток длинного текста в левой. Если уменьшить ширину окна браузера, медиазапросы изменят разбивку страницы, перераспределяя изображения в более узкую одноколоночную структуру. Применение `break-after: region` для контейнеров с изображениями обеспечивает разрыв после каждого изображения в потоке. 

**Примечание:** В некоторых реализациях используются не предусмотренные стандартами свойства разрывов с префиксом `region`; например, `region-break-before` или, с вендорным префиксом, `-webkit-region-break-before`.

![Отзывчивая вёрстка][Отзывчивая вёрстка]

*Свойство `break-after` применяется для областей с помощью медиазапросов*

## Области и относительные единицы

Относительные единицы позволяют использовать окно (или область просмотра) как основу для изменения размеров элементов, что добавляет последовательное соотношение сторон и гармонию в верстку. Вы получаете возможность моделировать страницы или блоки, в которых контент разбивается на сплочённые группы. Подводным камнем этого подхода может стать то, что если вы используете соотношение сторон устройства для определения размеров контейнеров, и ширины и высоты, контент может перестать в них помещаться.

Можно, однако, использовать области для разбивки контента, соблюдая переменный размер элементов при разных размерах экрана. Применение этого приёма можно увидеть в «[Демо для слонов-сирот National Geographic][4].» На этом вебсайте изображения и текст преобразовываются чтобы сохранять высоту области просмотра. Использованы области для распределения потока контента по всех текстовых блоках и они подстраиваются когда пользователь уменьшает область просмотра.

![демо][демо со слонами]

*Использование областей с относительными единицами. Обратите внимание как точно изображение заполняет окно. ([Крупнее][5])*

Для навигации по журналам и книгам на планшетах часто используется разбивка на страницы, т.е. пользователь получает возможность перелистнуть страницу с контентом используя свайп или тап. Перед разработчиками стоит задача сделать эти страницы чувствительными к различным размерам экрана. Для такой верстки превосходно подходят области, так как они позволяют задавать размер колонок в относительных единицах и создавать различные разбивки страниц, в которых контент может распределяться между колонками. Пример того, как это можно сделать в HTML показан на [видео ниже][6]: 

<iframe src="//www.youtube.com/embed/zKjoZvRCyh0" allowfullscreen="" frameborder="0" height="281" width="500"></iframe>

На вебсайте [Kindle Cloud Reader][7] можно увидеть похожий двухстраничный разворот, однако здесь для управления версткой используется JavaScript. Реализация такой верстки с помощью JavaScript очень затратна в плане усилий со стороны разработчиков, к тому же настолько неэкономичный подход к управлению DOM обычно ведёт к снижению производительности. Для органичного воплощения таких возможностей в браузере можно использовать области, тем самым повышая производительность вебсайта и уменьшая длительность разработки.

## Отладка

В работе с областями пригодятся инструменты для упрощённого управления и отладки различных компонентов. В панели инструментов разработчика в Chrome можно активировать инструменты отладки областей. Подробные инструкции по активации этих инструментов можно найти в публикации Кристиана Кантрелла (Christian Cantrell) «[Поддержка CSS-областей в Веб-инспекторе][8].» С помощью этих инструментов вы сможете обнаружить все проименованные потоки в документе, определить контент и цепочку областей, привязанных к каждому проименованному потоку и получить визуальные подсказки того помещается ли контент в область исходя из свойства `regionOverset`.

В сборку Webkit Nightly также добавлены полезные визуальные подсказки. Если открыть Веб-инспектор и просмотреть код для контейнера области, можно увидеть номер области и ссылки между контейнерами областей, демонстрирующие поток контента.

![отладка][отладка областей]

*В Webkit Nightly есть возможность просматривать код контейнеров областей, их номер и цепочку областей*

## Материалы для дальнейшего чтения

Области открывают множество возможностей для отзывчивой разработки и обеспечения отличного представления контента независимо от размеров. Один из отзывчивых сайтов, уникальная верстка которого была создана с помощью областей — [демо для компании по производству велосипедов][9] от Adobe, созданная с использованием Edge Reflow. Подпишитесь на [@adobeweb][10] чтобы следить за последними обновлениями по областям и другим новым веб-инструментам. Также рекомендуем просмотреть [подборку от Adobe на CodePen][11], в которой продемонстрировано использование областей на практике; возможно у вас возникнет желание скопировать код одного-двух примеров чтобы изучить различные варианты использования областей.

Больше информации по областям можно найти в [блоге команды веб платформы][12] от Adobe, в котором часто публикуются новости о спецификациях и их реализации. Полные подробности можно найти в Спецификации для CSS-областей, в которой описаны все вопросы, рассмотренные в этой статье и другие. Также больше информации представлено в разделе «[Области][14]» на сайте Adobe.

[1]: http://html.adobe.com/webplatform/enable/
[2]: http://html.adobe.com/webplatform/layout/regions/browser-support/
[3]: http://nimbu.in/bdconf/regions-raven.html
[4]: https://github.com/adobe-webplatform/Demo-for-National-Geographic-Orphan-Elephants
[5]: http://media.smashingmagazine.com/wp-content/uploads/2013/10/elephant_large.jpg
[6]: http://www.youtube.com/watch?v=mS3UUneazN8
[7]: https://read.amazon.com/
[8]: http://blogs.adobe.com/webplatform/2012/09/27/web-inspector-support-for-css-regions/
[9]: http://html.adobe.com/edge/reflow/demo/bike&co/
[10]: https://twitter.com/adobeweb
[11]: http://codepen.io/collection/jabto
[12]: http://blogs.adobe.com/webplatform/category/features/css-regions/
[13]: http://dev.w3.org/csswg/css-regions/
[14]: http://html.adobe.com/webplatform/layout/regions/

[Отзывчивая вёрстка]: img/Google-Chrome.gif
[демо со слонами]: img/elephant-demo2.jpg
[отладка областей]: img/region_debugging.png